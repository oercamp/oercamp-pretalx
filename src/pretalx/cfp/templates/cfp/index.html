{% extends "common/base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% translate "Events" %}{% endblock %}

{% block content %}

    {% if widget_event and widget_event.pretix_ticket_shop_link and widget_event.pretix_ticket_shop_base_url %}
      <script type="text/javascript" src="{{ widget_event.pretix_ticket_shop_base_url }}/widget/v1.en.js" async crossorigin></script>
      <link rel="stylesheet" type="text/css" href="{{ widget_event.pretix_ticket_shop_link }}/widget/v1.css" crossorigin>
      <script src="{% static "common/js/pretix_widget.js" %}"></script>
    {% endif %}

    {% if registered_events or current_events or future_events or past_events %}
        <h1>{% translate "Events" %}</h1>
    {% endif %}

    <h2>{% translate "Registered events" %}</h2>
    {% if registered_events %}
    <ul>
      {% for event in registered_events %}
        <li class="d-flex flex-row align-items-center">
          <a href="{{ event.urls.schedule }}">
            {{ event.name }}
            ({{ event.get_date_range_display }})
          </a>
        </li>
      {% endfor %}
    </ul>
    {% elif request.user.is_anonymous %}
    <ul>
      <li class="d-flex flex-row align-items-center">
        <i class="fa fa-sign-in mr-2"></i>
        <a href="/">{% translate "Please login or register to see your registered events." %}</a>
      </li>
    </ul>
    {% else %}
      <p>{% translate "You are currently not registered for any events." %}</p>
    {% endif %}

    <h2>{% translate "Other events" %}</h2>

    {% if current_events %}
        <h3>{% translate "Current events" %}</h3>
        <ul>
            {% for event in current_events %}
                <li class="d-flex flex-row align-items-center">
                  {% if event.pretix_ticket_shop_link %}
                    <i class="fa fa-ticket mr-2"></i>
                  {% endif %}
                  <a href="{{ event.pretix_ticket_shop_link | default:event.urls.base }}"{% if event.pretix_ticket_shop_link %} class="btn-pretix-purchase-ticket" skip-ssl-check{% endif %}>
                    {{ event.name }}
                    ({{ event.get_date_range_display }})
                  </a>
                  <div class="ml-auto">
                    <a
                      class="btn btn-outline-info m-1"
                      href="{{ event.urls.base }}"
                      data-toggle="tooltip"
                      data-placement="top"
                      title="{% translate 'View conference schedule' %}"
                    >
                      <i class="fa fa-calendar"></i>
                      {% translate 'Program' %}
                    </a>
                    {% if event.pretix_ticket_shop_link %}
                      <a
                        class="btn btn-outline-info m-1 btn-pretix-purchase-ticket"
                        href="{{ event.pretix_ticket_shop_link }}"
                        data-toggle="tooltip"
                        data-placement="top"
                        title="{% translate 'Purchase ticket' %}"
                      >
                        <i class="fa fa-ticket"></i>
                        {% translate 'Purchase ticket' %}
                      </a>
                    {% endif %}
                  </div>
                </li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if future_events %}
        <h3>{% translate "Upcoming events" %}</h3>
        <ul>
            {% for event in future_events %}
            <li class="d-flex flex-row align-items-center">
                {% if event.pretix_ticket_shop_link %}
                    <i class="fa fa-ticket mr-2"></i>
                {% endif %}
                <a href="{{ event.pretix_ticket_shop_link | default:event.urls.base }}"{% if event.pretix_ticket_shop_link %} class="btn-pretix-purchase-ticket" skip-ssl-check{% endif %}>
                    {{ event.name }}
                    ({{ event.get_date_range_display }})
                </a>
                <div class="ml-auto">
                  <a
                    class="btn btn-outline-info m-1"
                    href="{{ event.urls.base }}"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="{% translate 'View conference schedule' %}"
                  >
                    <i class="fa fa-calendar"></i>
                    {% translate 'Program' %}
                  </a>
                  {% if event.pretix_ticket_shop_link %}
                  <a
                    class="btn btn-outline-info m-1 btn-pretix-purchase-ticket"
                    href="{{ event.pretix_ticket_shop_link }}"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="{% translate 'Purchase ticket' %}"
                  >
                    <i class="fa fa-ticket"></i>
                    {% translate 'Purchase ticket' %}
                  </a>
                  {% endif %}
              </div>
            </li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if past_events %}
        <h3>{% translate "Past events" %}</h3>
        <ul>
            {% for event in past_events %}
            <li class="d-flex flex-row align-items-center">
              {% if event.pretix_ticket_shop_link %}
              <i class="fa fa-ticket mr-2"></i>
              {% endif %}
              <a href="{{ event.pretix_ticket_shop_link | default:event.urls.base }}">
                  {{ event.name }}
                  ({{ event.get_date_range_display }})
              </a>
              <div class="ml-auto">
                <a
                  class="btn btn-outline-info m-1"
                  href="{{ event.urls.base }}"
                  data-toggle="tooltip"
                  data-placement="top"
                  title="{% translate 'View conference schedule' %}"
                >
                  <i class="fa fa-calendar"></i>
                  {% translate 'Program' %}
                </a>
                {% if event.pretix_ticket_shop_link %}
                <a
                  class="btn btn-outline-info m-1"
                  href="{{ event.pretix_ticket_shop_link }}"
                  data-toggle="tooltip"
                  data-placement="top"
                  title="{% translate 'Purchase ticket' %}"
                >
                  <i class="fa fa-ticket"></i>
                  {% translate 'Purchase ticket' %}
                </a>
                {% endif %}
              </div>
            </li>
            {% endfor %}
        </ul>
    {% endif %}
{% endblock %}
