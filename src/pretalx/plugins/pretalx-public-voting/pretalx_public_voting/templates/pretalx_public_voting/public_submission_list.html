{% extends "cfp/event/base.html" %}
{% load bootstrap4 %}
{% load i18n %}
{% load rich_text %}
{% load static %}

{% block content %}
    <script src="{% static "vendored/jquery-3.1.1.js" %}"></script>
    <script src="{% static "pretalx_public_voting/vote.js" %}"></script>
    <link rel="stylesheet" href="{% static "pretalx_public_voting/vote.css" %}" />

    {% include "agenda/header_row.html" with with_margin=True %}
    <h1>{% trans "Public voting" %}</h1>
    {{ request.event.public_vote_settings.text|rich_text }}

    <p>
      {% blocktrans trimmed %}
      Here you can see all submissions and their comments.
      {% endblocktrans %}
       <a href="{% url "plugins:pretalx_public_voting:signup" event=request.event.slug %}">{% trans "Click here to sign up for voting." %}</a>
    </p>
    <div>
      {% for submission in submissions %}
      <div class="card submission-card">
        {% if submission.image and request.event.public_vote_settings.show_session_image %}
        <div class="card-img-top-wrapper">
          <img loading="lazy" src="{{ submission.image.url }}" alt="{% trans "This talk's header image" %}" class="card-img-top">
        </div>
        {% endif %}
        <div class="card-body">
          <h3 class="card-title">{{ submission.title }}</h3>
          {% if not request.event.public_vote_settings.anonymize_speakers %}
          <p class="card-subtitle mb-2 text-muted">{{ submission.display_speaker_names }}</p>
          {% endif %}
          <div class="card-text">
            {{ submission.abstract|rich_text|default:'-' }}
            {% if request.event.public_vote_settings.show_session_description and submission.description %}
            {{ submission.description|rich_text|default:'-' }}
            {% endif %}
          </div>
        </div>
        <div class="card-header card-footer card-columns align-items-start">
          <strong class="w-25 pr-2">{% trans "Public Comments" %}:</strong>
          <div class="flex-grow-1">
            {% for submission_comment in submission.comments %}
            <p class="card p-2 bg-light">
              {{ submission_comment }}
            </p>
            {% empty %}
            <p>-</p>
            {% endfor %}
            <p>
              <a class="float-right" href="{% url "plugins:pretalx_public_voting:signup" event=request.event.slug %}">{% trans "Click here to write a comment." %}</a>
            </p>
          </div>
        </div>
      </div>
      {% empty %}
      <p>No submissions yet.</p>
      {% endfor %}
      {% include "orga/includes/pagination.html" %}
    </div>
{% endblock %}
